#!/bin/bash
#
# Checking for Xcode command line tools
# ------------------------------------------------------------
if [[xcode-select -p 1>/dev/null;echo $? == 0 ]] ; then
        echo "Xcode command line tools are already installed..."
else
        echo "Xcode command line tools not installed..."
        echo "Please check Xcode installation..."
fi

# Checking homebrew installation
# ------------------------------
which -s brew
if [[ $? != 0 ]] ; then
    # Install Homebrew
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
    brew update
fi

# Installing Yabai
# ----------------
# clone tap
brew tap koekeishiya/formulae
# install latest stable version
brew install yabai

# Checking yabai installation
# ------------------------------------------------------------
which -s yabai
if [[ $? != 0 ]] ; then
    echo "something went wrong, please troubleshoot.."
else
    echo "yabai has been successfully installed.."
fi

# symlinking yabai config file as dotfile to home directory. 
# ------------------------------------------------------------
ln -s ./yabairc ~/.yabairc
# checking symlink and sourcing config
if [[ -f ~/.yabairc ]]; then
    echo "symlinking has been successful"
    source ~/.yabairc
fi

# Starting brew service yabai
# ------------------------------------------------------------
if [[ $(brew services list | sed -n '/yabai/p' | awk '{ print $2 }') ==
    "started" ]] ; then
    echo "yabai is running.."
elif [[ $(brew services list | sed -n '/yabai/p' | awk '{ print $2 }') ==
    "stopped" ]] ; then
        echo "yabai is not running, starting yabai service.."
        brew services start yabai
    else
        echo "yabai doesn't seems to be installed.."
fi


